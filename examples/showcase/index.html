<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      ui-lib Showcase - The Most Ergonomic Component Library Ever Built
    </title>

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/assets/logo.svg">

    <!-- HTMX for interactivity -->
    <script src="https://unpkg.com/htmx.org@2.0.3/dist/htmx.min.js"></script>
    <script
      src="https://unpkg.com/htmx-ext-json-enc@2.0.1/json-enc.js"
    ></script>

    <!-- Prism for syntax highlighting -->
    <link
      href="https://unpkg.com/prismjs@1.29.0/themes/prism-tomorrow.css"
      rel="stylesheet"
    >
    <script
      src="https://unpkg.com/prismjs@1.29.0/components/prism-core.min.js"
    ></script>
    <script
      src="https://unpkg.com/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"
    ></script>

    <!-- Open Props (design tokens) -->
    <link rel="stylesheet" href="https://unpkg.com/open-props@1.6.21" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/open-props@1.6.21/normalize.min.css"
    />

    <style id="showcase-styles">
      /* Base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-sans);
        background: linear-gradient(135deg, var(--gray-0) 0%, var(--surface-1) 100%);
        color: var(--text-1);
        line-height: var(--font-lineheight-3);
        min-height: 100vh;
      }

      /* Code highlighting */
      pre[class*="language-"] {
        margin: 0;
        background: transparent;
      }

      code[class*="language-"] {
        background: transparent;
      }

      /* Animation keyframes */
      @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }

      /* Warning variants for metrics */
      .warning {
        color: var(--yellow-6) !important;
      }

      .danger {
        color: var(--red-6) !important;
      }

      /* Modal visibility - ensure modals are hidden by default */
      .modal-overlay {
        display: none !important;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal-overlay.open { display: flex !important; }

      /* Minimal modal shell for inline examples */
      .modal-content {
        background: var(--surface-1);
        border-radius: var(--radius-3);
        width: 90%;
        max-width: 1000px;
        max-height: 85vh;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow-6);
        animation: var(--animation-slide-in-up);
      }
      .modal-header {
        padding: var(--size-fluid-2);
        background: var(--surface-2);
        border-bottom: 1px solid var(--surface-3);
        border-radius: var(--radius-3) var(--radius-3) 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .modal-title { font-size: var(--font-size-3); font-weight: var(--font-weight-7); }
      .modal-body { flex: 1; overflow: auto; padding: 0; }
      .modal-footer { padding: var(--size-3); background: var(--surface-2); border-top: 1px solid var(--surface-3); display: flex; gap: var(--size-3); justify-content: flex-end; }
      .modal-close-btn { background: none; border: none; font-size: var(--font-size-4); cursor: pointer; color: var(--text-2); }
      .btn { padding: var(--size-2) var(--size-4); background: var(--surface-1); border: 1px solid var(--surface-3); border-radius: var(--radius-2); cursor: pointer; font-size: var(--font-size-1); font-weight: var(--font-weight-5); }
      .btn:hover { background: var(--surface-2); }
      .btn-primary { background: var(--gradient-3); color: var(--gray-0); border: none; }
      .code-content { padding: var(--size-fluid-2); background: var(--gray-11); color: var(--gray-0); font-family: var(--font-mono); font-size: var(--font-size-0); line-height: var(--font-lineheight-3); }

      /* Demo content should not display raw text */
      #demo-content {
        min-height: 500px;
      }

      /* Showcase utility styles will be injected here by components */
    </style>
  </head>
  <body hx-ext="json-enc">
    <!-- Hero Section -->
    <showcase-hero-section></showcase-hero-section>

    <!-- Feature Cards -->
    <showcase-feature-cards></showcase-feature-cards>

    <!-- Metrics Bar -->
    <showcase-metrics-bar></showcase-metrics-bar>

    <!-- Live Demo Section -->
    <showcase-demo-viewer></showcase-demo-viewer>

    <!-- Forms Demo -->
    <showcase-forms-demo></showcase-forms-demo>

    <!-- Footer -->
    <showcase-footer></showcase-footer>

    <!-- Shopping Cart System -->
    <showcase-cart-sidebar></showcase-cart-sidebar>

    <!-- Modals will be dynamically created by JavaScript when needed -->

    <script>
      // Global cart action function for reactive helpers
      window.uiLibCartAction = function (action, itemData) {
        console.log("üõí Cart " + action + ":", itemData);
        const currentCart = window.funcwcState?.getState("cart") ||
          { items: [], count: 0, total: 0 };
        let newItems = [...currentCart.items];

        if (action === "add") {
          const existing = newItems.findIndex((item) =>
            item.id === itemData.id
          );
          if (existing >= 0) {
            newItems[existing].quantity += itemData.quantity || 1;
          } else {
            newItems.push(itemData);
          }
        } else if (action === "remove") {
          newItems = newItems.filter((item) => item.id !== itemData.id);
        } else if (action === "update") {
          const existing = newItems.findIndex((item) =>
            item.id === itemData.id
          );
          if (existing >= 0) {
            newItems[existing] = { ...newItems[existing], ...itemData };
          }
        }

        const cartState = {
          items: newItems,
          count: newItems.reduce((sum, item) => sum + item.quantity, 0),
          total: newItems.reduce(
            (sum, item) => sum + (item.price * item.quantity),
            0,
          ),
          isEmpty: newItems.length === 0,
        };

        window.funcwcState?.publish("cart", cartState);

        // Update cart count in floating button and sidebar
        document.querySelectorAll(".cart-count").forEach((el) => {
          el.textContent = cartState.count;
        });

        // Update cart total in sidebar
        document.querySelectorAll(".cart-total").forEach((el) => {
          el.textContent = "$" + cartState.total.toFixed(2);
        });
      };

      // Demo loading functions
      function showDemo(feature) {
        const content = document.getElementById("demo-content");
        content.innerHTML =
          '<div class="loading">Loading demo...</div>';

        // Use HTMX to load the demo
        htmx.ajax("GET", `/api/demo/${feature}`, {
          target: "#demo-content",
          swap: "innerHTML",
        });
      }

      function loadDemo(demoName) {
        // Update active tab
        document.querySelectorAll(".showcase-demo-tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.querySelector(`[data-demo="${demoName}"]`).classList
          .add("active");

        // Load demo content with preview-only layout and modal for code
        const content = document.getElementById("demo-content");
        const modalId = `code-modal-${demoName}`;

        content.innerHTML = `
        <div class="viewer" data-component="showcase-demo-viewer">
          <!-- Full-width Preview -->
          <div class="preview-panel">
            <div class="preview-content" id="preview-${demoName}" hx-get="/api/showcase/preview/${demoName}" hx-trigger="load">
              Loading preview...
            </div>
          </div>

          <!-- Code Modal -->
          <div id="${modalId}" class="modal-overlay">
            <div class="modal-content">
              <div class="modal-header">
                <span class="modal-title">üìù ui-lib Code</span>
                <button onclick="document.getElementById('${modalId}').style.display='none'" class="modal-close-btn">‚úï</button>
              </div>
              <div class="modal-body">
                <pre class="code-content">
                  <code id="code-${demoName}" hx-get="/api/showcase/code/${demoName}" hx-trigger="load">Loading code example...</code>
                </pre>
              </div>
              <div class="modal-footer">
                <button onclick="copyCode(this)" class="btn">üìã Copy Code</button>
                <button onclick="document.getElementById('${modalId}').style.display='none'" class="btn btn-primary">Close</button>
              </div>
            </div>
          </div>
        </div>

        <style>
          @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
          }
        </style>
      `;

        // Process the new content with HTMX
        htmx.process(content);
      }



      // Start animations when page loads
      document.addEventListener("DOMContentLoaded", function () {
        // Animate metrics after a brief delay to ensure components are loaded
        setTimeout(() => {
          const metrics = {
            "bundle-size": { start: 0, end: 0, unit: "kb" },
            "component-count": { start: 0, end: 47, unit: "" },
            "render-time": { start: 0, end: 3, unit: "ms" },
            "memory-usage": { start: 0, end: 1.2, unit: "MB" },
            "type-coverage": { start: 0, end: 100, unit: "%" },
          };

          Object.entries(metrics).forEach(([id, config]) => {
            const element = document.getElementById(id);
            if (!element) return; // Skip if element doesn't exist
            
            let current = config.start;
            const increment = (config.end - config.start) / 30;

            const timer = setInterval(() => {
              current += increment;
              if (current >= config.end) {
                current = config.end;
                clearInterval(timer);
              }
              element.textContent = `${current.toFixed(1)}${config.unit}`;
            }, 50);
          });
        }, 100);
        
        // Load initial demo with modal system
        loadDemo("ecommerce");
      });

      // Add smooth scroll
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          document.querySelector(this.getAttribute("href"))
            .scrollIntoView({
              behavior: "smooth",
            });
        });
      });

      // Button interactivity functions
      window.copyCode = function (btn) {
        const codePanel = btn.closest(".code-panel");
        if (!codePanel) return;

        const code = codePanel.querySelector("code").textContent;
        navigator.clipboard.writeText(code).then(() => {
          const original = btn.textContent;
          btn.textContent = "‚úÖ Copied!";
          setTimeout(() => btn.textContent = original, 2000);
        }).catch(() => {
          btn.textContent = "‚ùå Error";
          setTimeout(() => btn.textContent = "üìã Copy", 2000);
        });
      };

      window.formatCode = function (btn) {
        const original = btn.textContent;
        btn.textContent = "‚úÖ Formatted";
        setTimeout(() => btn.textContent = original, 1000);
      };




      // View Forms Code function
      window.viewFormsCode = function () {
        const modal = document.getElementById("forms-code-modal");
        if (modal) {
          modal.style.display = "flex";
        } else {
          // Create modal if it doesn't exist
          const modalHTML = `
            <div id="forms-code-modal" class="modal-overlay">
              <div class="modal-content">
                <div class="modal-header">
                  <h3 class="modal-title">üìù Forms Code</h3>
                  <button onclick="document.getElementById('forms-code-modal').style.display='none'" class="modal-close-btn">‚úï</button>
                </div>
                <div class="modal-body">
                  <pre class="code-content"><code>// Real Form Components with Validation

import { Form, Input, Button, Alert } from "ui-lib";

// Registration Form with Live Validation
const registrationForm = (
  &lt;form hx-post="/api/forms/register" hx-target="#result"&gt;
    {Input({
      type: "text",
      name: "firstName",
      label: "First Name",
      placeholder: "John",
      required: true
    })}

    {Input({
      type: "email",
      name: "email",
      label: "Email Address",
      placeholder: "john@example.com",
      required: true,
      helpText: "We'll never share your email"
    })}

    {Input({
      type: "password",
      name: "password",
      label: "Password",
      required: true,
      helpText: "At least 8 characters"
    })}

    {Alert({
      variant: "info",
      children: "All fields are validated in real-time"
    })}

    {Button({
      type: "submit",
      variant: "primary",
      children: "Create Account"
    })}
  &lt;/form&gt;
);

// Contact Form with Interactive Components
const contactForm = (
  &lt;form hx-post="/api/forms/contact" hx-target="#contact-result"&gt;
    {Input({
      type: "text",
      name: "name",
      label: "Full Name",
      required: true
    })}

    {Input({
      type: "email",
      name: "email",
      label: "Email",
      required: true
    })}

    {Input({
      type: "textarea",
      name: "message",
      label: "Message",
      placeholder: "Tell us about your project...",
      rows: 4,
      required: true
    })}

    {Button({
      type: "submit",
      variant: "primary",
      size: "lg",
      children: "Send Message"
    })}
  &lt;/form&gt;
);

// Newsletter with Validation
const newsletterForm = (
  &lt;form hx-post="/api/forms/newsletter"&gt;
    {Input({
      type: "email",
      name: "email",
      placeholder: "Enter your email",
      leftAddon: "üìß"
    })}

    {Button({
      type: "submit",
      variant: "secondary",
      children: "Subscribe"
    })}
  &lt;/form&gt;
);

// Server-side validation with HTMX responses
router.register("POST", "/api/forms/register", async (request) => {
  const formData = await request.formData();
  const { firstName, lastName, email, password } = Object.fromEntries(formData);

  // Real-time validation
  if (!email.includes("@")) {
    return new Response(\`
      &lt;div class="error-alert"&gt;‚ùå Please enter a valid email&lt;/div&gt;
    \`);
  }

  if (password.length &lt; 8) {
    return new Response(\`
      &lt;div class="error-alert"&gt;‚ùå Password must be at least 8 characters&lt;/div&gt;
    \`);
  }

  // Success response
  return new Response(\`
    &lt;div class="success-alert"&gt;‚úÖ Account created successfully!&lt;/div&gt;
  \`);
});</code></pre>
                </div>
              </div>
            </div>
          `;
          document.body.insertAdjacentHTML("beforeend", modalHTML);
        }
      };
    </script>
  </body>
</html>
