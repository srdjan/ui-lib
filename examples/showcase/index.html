<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ui-lib Showcase</title>

    <link rel="icon" type="image/svg+xml" href="/assets/logo.svg">

    <!-- HTMX for interactivity -->
    <script src="https://unpkg.com/htmx.org@2.0.7/dist/htmx.min.js"></script>
    <script src="https://unpkg.com/htmx-ext-json-enc@2.0.1/json-enc.js"></script>

    <!-- Open Props (design tokens) -->
    <link rel="stylesheet" href="https://unpkg.com/open-props@1.6.21" />
    <link rel="stylesheet" href="https://unpkg.com/open-props@1.6.21/normalize.min.css" />

    <style>
      /* Light base page styles; component utilities are injected server-side */
      html, body { height: 100%; margin: 0; }
      html { scrollbar-gutter: stable both-edges; }
      body {
        font-family: var(--font-sans);
        background: linear-gradient(135deg, var(--gray-0) 0%, var(--surface-1) 100%);
        color: var(--text-1);
      }
      #main-content { min-height: 60vh; position: relative; }
      /* HTMX swap/settle transition hooks */
      #main-content.htmx-swapping { opacity: 0; transition: opacity 200ms ease; }
      #main-content .htmx-added { opacity: 0; }
      #main-content.htmx-settling .htmx-added { opacity: 1; transition: opacity 200ms ease; }
    </style>
  </head>
  <body hx-ext="json-enc">
    <app-layout theme="system" responsive padding="var(--size-4)">
      <!-- Sidebar placeholders for OOB swaps -->
      <div id="ui-left-sidebar" style="display:none"></div>
      <div id="ui-right-sidebar" style="display:none"></div>
      <navbar position="top" style="transparent" sticky collapsible content-max-width="1200px">
        <li>
          <a
            href="/?demo=ecommerce"
            hx-get="/api/showcase/preview/ecommerce"
            hx-target="#main-content"
            hx-swap="innerHTML swap:200ms settle:200ms"
            hx-push-url="/?demo=ecommerce"
            class="nav-link"
            aria-label="E-commerce demo"
          >üè™ E‚Äëcommerce</a>
        </li>
        <li>
          <a
            href="/?demo=dashboard"
            hx-get="/api/showcase/preview/dashboard"
            hx-target="#main-content"
            hx-swap="innerHTML swap:200ms settle:200ms"
            hx-push-url="/?demo=dashboard"
            class="nav-link"
            aria-label="Dashboard demo"
          >üìä Dashboard</a>
        </li>
        <li>
          <a
            href="/?demo=forms"
            hx-get="/api/showcase/preview/forms"
            hx-target="#main-content"
            hx-swap="innerHTML swap:200ms settle:200ms"
            hx-push-url="/?demo=forms"
            class="nav-link"
            aria-label="Forms demo"
          >üìù Forms</a>
        </li>
        <li>
          <a
            href="/?demo=layout-left"
            hx-get="/api/showcase/layout/left"
            hx-target="#main-content"
            hx-swap="innerHTML swap:200ms settle:200ms"
            hx-push-url="/?demo=layout-left"
            class="nav-link"
            aria-label="Layout Left Sidebar"
          >‚¨ÖÔ∏è Layout Left</a>
        </li>
        <li>
          <a
            href="/?demo=layout-right"
            hx-get="/api/showcase/layout/right"
            hx-target="#main-content"
            hx-swap="innerHTML swap:200ms settle:200ms"
            hx-push-url="/?demo=layout-right"
            class="nav-link"
            aria-label="Layout Right Sidebar"
          >Layout Right ‚û°Ô∏è</a>
        </li>
        <li>
          <a
            href="/?demo=layout-none"
            hx-get="/api/showcase/layout/none"
            hx-target="#main-content"
            hx-swap="innerHTML swap:200ms settle:200ms"
            hx-push-url="/?demo=layout-none"
            class="nav-link"
            aria-label="Layout No Sidebar"
          >üö´ No Sidebar</a>
        </li>
      </navbar>

      <main-content max-width="1200px">
        <!-- SSR default content to avoid initial flicker -->
        <product-grid></product-grid>
      </main-content>
      <script>
        function pathForDemo(demo) {
          if (!demo) return null;
          if (demo.startsWith('layout-')) {
            const side = demo.split('-')[1] || 'left';
            return `/api/showcase/layout/${side}`;
          }
          return `/api/showcase/preview/${demo}`;
        }

        // Initial load: if a different demo is requested via ?demo, swap it in; otherwise leave SSR ecommerce
        document.addEventListener('DOMContentLoaded', function () {
          try {
            const url = new URL(window.location.href);
            const demo = url.searchParams.get('demo');
            if (demo && demo !== 'ecommerce') {
              const path = pathForDemo(demo);
              if (path) {
                htmx.ajax('GET', path, {
                  target: '#main-content',
                  swap: 'innerHTML swap:200ms settle:200ms',
                });
                history.replaceState({}, '', `/?demo=${demo}`);
              }
            } else if (!demo) {
              // Reflect default in URL without reloading content
              history.replaceState({}, '', '/?demo=ecommerce');
            }
          } catch (_) { /* no-op */ }
        });

        // Handle back/forward: reload the current demo
        window.addEventListener('popstate', function () {
          try {
            const url = new URL(window.location.href);
            const demo = url.searchParams.get('demo') || 'ecommerce';
            if (demo === 'ecommerce') {
              // SSR default already visible
            } else {
              const path = pathForDemo(demo);
              if (path) {
                htmx.ajax('GET', path, {
                  target: '#main-content',
                  swap: 'innerHTML swap:200ms settle:200ms',
                });
              }
            }
          } catch (_) { /* no-op */ }
        });
      </script>
    </app-layout>
  </body>
</html>
